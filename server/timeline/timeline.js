Photos = new Meteor.Collection("photos")

if (Meteor.isClient) {
  Template.hello.greeting = function () {
    return "Welcome to timeline.";
  };

  Template.hello.events({
    'click input' : function () {
      // template data, if any, is available in 'this'
      if (typeof console !== 'undefined')
        console.log("You pressed the button");
    }
  });
}

if (Meteor.isServer) {
  Meteor.startup(function () {
    var baseURL = 'file:///Users/blake/Dropbox/me_photos/';
    var filenames = [
      '20140122_143251_742_v0.1.1_20140122_143354_247.jpg',
      '20140122_143251_742_v0.1.1_20140122_143453_561.jpg',
      '20140122_143251_742_v0.1.1_20140122_143553_643.jpg',
      '20140122_143251_742_v0.1.1_20140122_143653_669.jpg',
      '20140122_143251_742_v0.1.1_20140122_143753_861.jpg',
      '20140122_143251_742_v0.1.1_20140122_143853_700.jpg',
      '20140122_143251_742_v0.1.1_20140122_143954_071.jpg',
      '20140122_143251_742_v0.1.1_20140122_144053_664.jpg',
      '20140122_143251_742_v0.1.1_20140122_144153_318.jpg',
      '20140122_143251_742_v0.1.1_20140122_144253_536.jpg',
      '20140122_143251_742_v0.1.1_20140122_144353_686.jpg',
      '20140122_143251_742_v0.1.1_20140122_144453_893.jpg',
      '20140122_143251_742_v0.1.1_20140122_144553_636.jpg',
      '20140122_143251_742_v0.1.1_20140122_144653_656.jpg',
      '20140122_143251_742_v0.1.1_20140122_144753_490.jpg',
      '20140122_143251_742_v0.1.1_20140122_144853_631.jpg',
      '20140122_143251_742_v0.1.1_20140122_144953_244.jpg',
      '20140122_145052_070_v0.1.1_20140122_145053_784.jpg',
      '20140122_145052_070_v0.1.1_20140122_145153_629.jpg',
      '20140122_150520_932_v0.1.1_20140122_150622_719.jpg',
      '20140122_150520_932_v0.1.1_20140122_150722_762.jpg',
      '20140122_150520_932_v0.1.1_20140122_150822_955.jpg',
      '20140122_150520_932_v0.1.1_20140122_151323_074.jpg',
      '20140122_150520_932_v0.1.1_20140122_151423_101.jpg',
      '20140122_151717_097_v0.1.1_20140122_151759_005.jpg',
      '20140122_151717_097_v0.1.1_20140122_151818_813.jpg',
      '20140122_151717_097_v0.1.1_20140122_151838_523.jpg',
      '20140122_151717_097_v0.1.1_20140122_151858_900.jpg',
      '20140122_151717_097_v0.1.1_20140122_151918_859.jpg',
      '20140122_151717_097_v0.1.1_20140122_151938_916.jpg',
      '20140122_151717_097_v0.1.1_20140122_151958_872.jpg',
      '20140122_151717_097_v0.1.1_20140122_152019_030.jpg',
      '20140122_151717_097_v0.1.1_20140122_152039_038.jpg',
      '20140122_151717_097_v0.1.1_20140122_152059_039.jpg',
      '20140122_151717_097_v0.1.1_20140122_152119_089.jpg',
      '20140122_151717_097_v0.1.1_20140122_152138_793.jpg',
      '20140122_151717_097_v0.1.1_20140122_152218_929.jpg',
      '20140122_151717_097_v0.1.1_20140122_152239_034.jpg',
      '20140122_151717_097_v0.1.1_20140122_152259_195.jpg',
      '20140122_151717_097_v0.1.1_20140122_152319_412.jpg',
      '20140122_151717_097_v0.1.1_20140122_152339_100.jpg',
      '20140122_151717_097_v0.1.1_20140122_152359_255.jpg',
      '20140122_151717_097_v0.1.1_20140122_152419_274.jpg',
      '20140122_151717_097_v0.1.1_20140122_152439_258.jpg',
      '20140122_151717_097_v0.1.1_20140122_152459_326.jpg',
      '20140122_151717_097_v0.1.1_20140122_152519_350.jpg',
      '20140122_151717_097_v0.1.1_20140122_152539_322.jpg',
      '20140122_151717_097_v0.1.1_20140122_152559_048.jpg',
      '20140122_151717_097_v0.1.1_20140122_152619_367.jpg',
      '20140122_151717_097_v0.1.1_20140122_152639_392.jpg',
      '20140122_151717_097_v0.1.1_20140122_152659_330.jpg',
      '20140122_151717_097_v0.1.1_20140122_152719_341.jpg',
      '20140122_151717_097_v0.1.1_20140122_152739_487.jpg',
      '20140122_151717_097_v0.1.1_20140122_152759_413.jpg',
      '20140122_151717_097_v0.1.1_20140122_152819_435.jpg',
    ];
    for (i in filenames) {
      Photos.insert({
        'time_millis': filenameToTimestamp(filenames[i]),
        'url': baseURL + filenames[i]
      });
    }
  });
}

function filenameToTimestamp(filename) {
  var tokens = filename.split('\.jpg')[0].split('_');

  var yearMonthDay = tokens[tokens.length - 3];
  var hourMinuteSecond = tokens[tokens.length - 2];
  var millis = tokens[tokens.length - 1];

  var year = yearMonthDay.substring(0, 4);
  var month = yearMonthDay.substring(4, 6);
  var day = yearMonthDay.substring(6, 8);

  var hours = hourMinuteSecond.substring(0, 2);
  var minutes = hourMinuteSecond.substring(2, 4);
  var seconds = hourMinuteSecond.substring(4, 6);

  return new Date(year, month, day, hours, minutes, seconds, millis);
}