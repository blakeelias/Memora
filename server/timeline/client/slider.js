files = [
"20140111_183239_637_9d51ecd_20140111_183321_424.jpg",
"20140111_183239_637_9d51ecd_20140111_183340_923.jpg",
"20140111_183239_637_9d51ecd_20140111_183400_922.jpg",
"20140111_183239_637_9d51ecd_20140111_183420_884.jpg",
"20140111_183239_637_9d51ecd_20140111_183500_976.jpg",
"20140111_183239_637_9d51ecd_20140111_183520_894.jpg",
"20140111_183239_637_9d51ecd_20140111_183540_934.jpg",
"20140111_183239_637_9d51ecd_20140111_183600_971.jpg",
"20140111_183239_637_9d51ecd_20140111_183620_905.jpg",
"20140111_183239_637_9d51ecd_20140111_183641_022.jpg",
"20140111_183239_637_9d51ecd_20140111_183700_894.jpg",
"20140111_183239_637_9d51ecd_20140111_183740_982.jpg",
"20140111_183239_637_9d51ecd_20140111_183800_943.jpg",
"20140111_183239_637_9d51ecd_20140111_183820_882.jpg",
"20140111_183239_637_9d51ecd_20140111_183841_056.jpg",
"20140111_183239_637_9d51ecd_20140111_183900_924.jpg",
"20140111_183239_637_9d51ecd_20140111_183920_876.jpg",
"20140111_183239_637_9d51ecd_20140111_183941_061.jpg",
"20140111_183239_637_9d51ecd_20140111_184001_486.jpg",
"20140111_183239_637_9d51ecd_20140111_184020_864.jpg",
"20140111_183239_637_9d51ecd_20140111_184040_847.jpg",
"20140111_183239_637_9d51ecd_20140111_184100_914.jpg",
"20140111_183239_637_9d51ecd_20140111_184121_039.jpg",
"20140111_183239_637_9d51ecd_20140111_184141_265.jpg",
"20140111_183239_637_9d51ecd_20140111_184201_407.jpg",
"20140111_183239_637_9d51ecd_20140111_184221_142.jpg",
"20140111_183239_637_9d51ecd_20140111_184241_292.jpg",
"20140111_183239_637_9d51ecd_20140111_184301_514.jpg",
"20140111_183239_637_9d51ecd_20140111_184322_047.jpg",
"20140111_183239_637_9d51ecd_20140111_184341_056.jpg",
"20140111_183239_637_9d51ecd_20140111_184401_173.jpg",
"20140111_183239_637_9d51ecd_20140111_184421_282.jpg",
"20140111_183239_637_9d51ecd_20140111_184441_283.jpg",
"20140111_183239_637_9d51ecd_20140111_184521_102.jpg",
"20140111_183239_637_9d51ecd_20140111_184541_114.jpg",
"20140111_183239_637_9d51ecd_20140111_184621_085.jpg",
"20140111_183239_637_9d51ecd_20140111_184641_273.jpg",
"20140111_183239_637_9d51ecd_20140111_184701_370.jpg",
"20140111_183239_637_9d51ecd_20140111_184720_871.jpg",
"20140111_183239_637_9d51ecd_20140111_184740_785.jpg",
"20140111_183239_637_9d51ecd_20140111_184801_745.jpg",
"20140111_183239_637_9d51ecd_20140111_184820_970.jpg",
"20140111_183239_637_9d51ecd_20140111_184840_872.jpg",
"20140111_183239_637_9d51ecd_20140111_184901_109.jpg",
"20140111_183239_637_9d51ecd_20140111_184921_255.jpg",
"20140111_183239_637_9d51ecd_20140111_184940_930.jpg",
"20140111_183239_637_9d51ecd_20140111_185002_059.jpg",
"20140111_183239_637_9d51ecd_20140111_185020_883.jpg",
"20140111_183239_637_9d51ecd_20140111_185040_907.jpg",
"20140111_183239_637_9d51ecd_20140111_185101_064.jpg",
"20140111_183239_637_9d51ecd_20140111_185120_926.jpg",
"20140111_183239_637_9d51ecd_20140111_185141_069.jpg",
"20140111_183239_637_9d51ecd_20140111_185201_077.jpg",
"20140111_183239_637_9d51ecd_20140111_185221_052.jpg",
"20140111_183239_637_9d51ecd_20140111_185240_919.jpg",
"20140111_183239_637_9d51ecd_20140111_185301_308.jpg",
"20140111_183239_637_9d51ecd_20140111_185321_127.jpg",
"20140111_183239_637_9d51ecd_20140111_185341_154.jpg",
"20140111_183239_637_9d51ecd_20140111_185401_308.jpg",
"20140111_183239_637_9d51ecd_20140111_185421_229.jpg",
"20140111_183239_637_9d51ecd_20140111_185441_230.jpg",
"20140111_183239_637_9d51ecd_20140111_185501_294.jpg",
"20140111_183239_637_9d51ecd_20140111_185521_205.jpg",
"20140111_183239_637_9d51ecd_20140111_185541_284.jpg",
'20140111_183239_637_9d51ecd_20140111_185601_369.jpg',
'20140111_183239_637_9d51ecd_20140111_185621_272.jpg',
'20140111_183239_637_9d51ecd_20140111_185641_398.jpg',
'20140111_183239_637_9d51ecd_20140111_185701_111.jpg',
'20140111_183239_637_9d51ecd_20140111_185721_281.jpg',
'20140111_183239_637_9d51ecd_20140111_185741_269.jpg',
'20140111_183239_637_9d51ecd_20140111_185801_253.jpg',
'20140111_183239_637_9d51ecd_20140111_185821_203.jpg',
'20140111_183239_637_9d51ecd_20140111_185841_139.jpg',
'20140111_183239_637_9d51ecd_20140111_185901_158.jpg',
'20140111_183239_637_9d51ecd_20140111_185921_243.jpg',
'20140111_183239_637_9d51ecd_20140111_185941_088.jpg',
'20140111_183239_637_9d51ecd_20140111_190001_030.jpg',
'20140111_183239_637_9d51ecd_20140111_190021_260.jpg',
'20140111_183239_637_9d51ecd_20140111_190041_307.jpg']

if (Meteor.isClient) {

	var picw = 2528;
	var pich = 1856;
	var scale = 8;
	var current_picture;

	$(document).ready(function()
	{
		var knob = $( "#slider_knob" );
		var slider = $( "#slider_body" );
		
		var sliderLeft = 0;
		var knobLeft = 0;
		var position = 0;
		knob.draggable(
		{
			containment: "parent",	
			axis: "x",
			drag: function() 
			{
	        	sliderLeft = slider.offset().left;
				knobLeft = knob.offset().left;
				knobRel = knobLeft - sliderLeft;
				position = knobRel / (slider.width() - knob.width()/2);
				updatePix(position);
				/*$(this).text(String(position));*/
			},
			stop: function()
			{

			}
		});

		$(window).resize(function(){
			var newPos = slider.offset().left + slider.width()*position;
			knob.offset({ left: newPos});
		});

	});

	function updatePix(pos)
	{
		picIndex = Math.round(files.length * pos);
		var pic = $("#current_picture img");
		if(files[picIndex] != current_picture)
		{
			current_picture = files[picIndex]
			pic.attr("src", "/last_night/"  + current_picture);
			pic.attr("height", pich/scale);
			pic.attr("width", picw/scale);
		}
	}
}

function photosNearDate(date, nBefore, nAfter) {
  /**
   * Returns a list 
   * [thisPhoto, beforePhotos, afterPhotos]
   *     thisPhoto: {url: <url>, time_millis: <date>}
   *     beforePhotos: list of up to nBefore photos that have time_millis earlier than that of thisPhoto, 
   *     afterPhotos: list of up to nAfter photos that have time_millis after that of thisPhoto
   */

   var before = Photos.find({time_millis: {$lte: date}}).limit(nBefore).fetch();
   var after = Photos.find({time_millis: {$gte: date}}).limit(nAfter).fetch();
}